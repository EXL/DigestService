Заметки по переносу Telegram-бота Gadget Hackwrench
===================================================

Прошлый проект: [DigestBot](https://github.com/EXL/DigestBot).

Причины переноса на Java и Spring Framework с JavaScript и Node.js:

1. Низкое качество кодовой базы, сказывающееся на добавлении различной функциональности и расширений для бота.
2. Архитектектурно неправильное построение некоторых вещей, требующее полной переработки.
3. Унификация в виде единой платформы для сайта и подобных приложений на Java и JVM.
4. Хороший способ познакомиться с фреймворком Spring.

Начнём со списка команд, на которые должен отвечать бот и отметим особенности их переноса.

1. Команда `/digest` просто берёт несколько последних дайджестов из БД и отправляет их в чат с кнопками, где будет некоторое количество страниц выдачи.
2. Команда `/rates` запрашивает данные банка о валютах из специального кеша. В кеш они попадают раз или два раза в день. Поведение аналогично предыдущему, за исключением кеша.
3. Команда `/charts` аналогична той, что была. Но требуется сократить количество кнопок и убрать некоторые лишние источники. Желательно, чтобы выдача конфигурировалась каким-либо классом или нечто подобным, чтобы источники можно было добавлять или удалять из списка, просто редактируя файл.
4. Команда `/start` просто выводит текстовое сообщение.
5. Команда `/coffee` отправляет в чат специально подготовленный стикер.
6. Команда `/help` выводит справку по командам бота, которая включает или не включает администраторские команды.
7. Администраторская команда `/hi` и `/hello` должны быть перенесены без изменений. Работают они следующим образом: из небольшого массива текстовых сообщений, приветствующих пользователя, выбираются несколько случайных и отправляются в чат. Требуется сделать нормальный контейнер для группы подобных строк, чтобы к нему можно было обращаться по индексу.
8. Администраторская команда `/stackClear` или `/clearStack` будет удалена. Её функциональность абсолютно ненужна.
9. Администраторская команда `/count` будет удалена. Причина см. выше.
10. Администраторская команда `/delete <arg>` если и будет реализована, то в последнюю очередь.
11. Администраторская команда `/stackView` будет удалена, её функциональность будет перенесена в `/delete` без аргументов.
12. Администраторская команды `/stackSave` или `/saveStack`, `/stackRestore` или `/restoreStack` будут удалены за ненадобностью.
13. Администраторская команда `/send <chat id> <message>`, отправить <message> в <chat id> нужна и будет реализована в неизменном виде.
14. Администраторская команда `/eval <JavaScript expression>` будет полностью удалена.
15. Администраторская команда `/sticker <chat id> <sticker id>` будет сохранена, через внутренности её реализации будет создана команда `/coffee`.
16. Администраторская команда `/hostip` будет сохранена, вместо утилиты `curl` будет использоваться различные фишки из Java или Spring.

Теги, на которые должен реагировать бот -- `#digest` или `#news`, увидя их в тексте бот должен инициировать запись данных в БД. Здесь возникает вопрос про недельный shrink базы, отличной от нашего чата. Сделать его на стороне базы или лучше с помощью CRUD и сервиса в Spring, если он это позволяет.

Таким образом, требуется релизовать функциональность для следующих сущностей:

1. `/digest` +
2. `/rates` +
3. `/charts` +
4. `/start` +
5. `/coffee` +
6. `/help` +
7. `/hi` +
8. `/hello` +
9. `/delete` +
10. `/send <chat id> <message>` +
11. `/sticker <chat id> <sticker id>` +
12. `/hostip` +
13. `/game` +
14. `/image <chat id> <url>` +
15. `/show` +
16. `/debug` -
17. `#digest` +
18. `#news` +

С чего начать? С продумывания базовой архитектуры проекта, посмотреть примеры Spring-приложений, построенных с использованием этой библиотеки можно [здесь](https://github.com/rubenlagus/TelegramBots/network/dependents?package_id=UGFja2FnZS0zMTc5NTk2NjQ%3D). В частности, интересен проект [cat-girl-assistant](https://github.com/JackSmellyDog/cat-girl-assistant).

Кроме того, требуется проверить возможность удобной работы с получением различных данных вроде изображений, JSON и XML котировок с различных удалённых источников. Обеспечить работу задержки на кнопках.

После заняться Crawler'ом постов с форума MotoFan.Ru, с возможностью организации подписок. Здесь требуется задержка для очереди сообщений и подобного.

Ещё нужно обеспечить отлов различных событий в чате, например, смены фотографии или вход/выход нового участника.

Более удачный пример использования архитектуры приложения в [этом репозитории](https://github.com/jonigl/tacs-grupo1-api).

* `/debug RefreshRates`  - Принудительно обновить котировки.
* `/debug UseUriInsteadFiles` - Использовать ссылки вместо скачивания файлов.
* `/debug EnableLogUpdates` - Выводить Updates сразу в лог.
* `/debug UseStackForDelay` - Использовать стэк для задержки.
* `/debug DisableGreetings` - Отключить приветствия новых пользователей или их выход.

- Банк KZ @Sebastianxy1
- Подписка @Motofan
- Нейтральное реагирование на digest'ы @baaaaat

Оптимизация циклов fori.
Разобраться со связями в БД.

Добавить табличку в БД, в которой будут различные опции.
Array List vs List в чём разница? Найти по коду.
Заменить все Integer в БД на Long.
Какие типы лучше использовать? Примитивные или классовые?
